<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>TodoApp SAMPLE FILE</title>
	<style>
		/*! destyle.css v4.0.1 | MIT License | https://github.com/nicolas-cusan/destyle.min.css */
		*,::before,::after{box-sizing:border-box;border-style:solid;border-width:0;min-width:0}html{line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}body{margin:0}main{display:block}p,table,blockquote,address,pre,iframe,form,figure,dl{margin:0}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;margin:0}ul,ol{margin:0;padding:0;list-style:none}dt{font-weight:700}dd{margin-left:0}hr{box-sizing:content-box;height:0;overflow:visible;border-top-width:1px;margin:0;clear:both;color:inherit}pre{font-family:monospace,monospace;font-size:inherit}address{font-style:inherit}a{background-color:transparent;text-decoration:none;color:inherit}abbr[title]{text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:inherit}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}svg,img,embed,object,iframe{vertical-align:bottom}button,input,optgroup,select,textarea{-webkit-appearance:none;appearance:none;vertical-align:middle;color:inherit;font:inherit;background:transparent;padding:0;margin:0;border-radius:0;text-align:inherit;text-transform:inherit}button,[type="button"],[type="reset"],[type="submit"]{cursor:pointer}button:disabled,[type="button"]:disabled,[type="reset"]:disabled,[type="submit"]:disabled{cursor:default}:-moz-focusring{outline:auto}select:disabled{opacity:inherit}option{padding:0}fieldset{margin:0;padding:0;min-width:0}legend{padding:0}progress{vertical-align:baseline}textarea{overflow:auto}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{outline-offset:-2px}[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}[type="number"]{-moz-appearance:textfield}label[for]{cursor:pointer}details{display:block}summary{display:list-item}[contenteditable]:focus{outline:auto}table{border-color:inherit;border-collapse:collapse}caption{text-align:left}td,th{vertical-align:top;padding:0}th{text-align:left;font-weight:700}
	</style>
	<style>
		body {
			text-align: center;
			color: #efefef;
			background-color: #1f1f1f;
			height: 100vh;
			font-size: 16px;
			line-height: 1.6;
			margin: 0;
		}

		.content-wrapper {
			opacity: 0;
			animation-name: anim-main;
			animation-duration: 4s;
			animation-fill-mode: forwards;
		}

		@keyframes anim-main {
			0% {
				opacity: 0;
			}
			100% {
				opacity: 1;
			}
		}

		.hidden {
			display: none;
		}

		.back-image {
			position: fixed;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			z-index: -1;
			opacity: 0.5;
		}

		header {
			height: 3em;
			overflow: hidden;
		}

		h1 {
			font-size: 2em;
		}

		h3 {
			font-size: 1.2em;
		}

		h1, h3 {
			text-decoration: underline;
		}

		main {
			padding: 1.25em 0;
			display: flex;
			justify-content: space-evenly;
		}

		section {
			padding: 1.2em;
			border-radius: 1em;
			border: lime solid 0.5em;
		}

		section > :not(:first-child),
		.task-list > :not(:first-child) {
			margin-top: 0.5em;
		}

		.todo-container {
			width: 40%;
		}

		.todo-container > div {
			transition-property: all;
			transition-duration: 1s;
		}

		.todo-container > section {
			width: 100%;
		}

		.todo-container > :not(:first-child) {
			margin-top: 2em;
		}

		.container-controller {
			height: 3em;
			border: 0.25em solid lime;
			border-radius: 1.2em;
		}

		.container-wrapper {
			height: 40em;
			overflow-x: hidden;
			overflow-y: auto;
			position: relative;
		}

		.hidden-container-wrapper {
			margin-top: 0em;
			height: 0em;
		}

		.list-container {
			height: 100%;
		}

		.hidden-list-container {
			height: 0px;
		}

		.task-list {
			height: calc(100% - 6.5em);
			padding: 1.25em;
			overflow-x: hidden;
			overflow-y: auto;
		}

		.list-container-bottom-button {
			width: 100%;
			height: 3em;
			font-size: 1.25em;
			border: 1px solid lime;
			border-radius: 5em;
			padding: 0.5em;
		}

		.delete-task-button:hover {
			background-color: #00ff002f;
		}

		.task {
			font-size: 1.25em;
			border: 1px solid lime;
			border-radius: 5em;
			padding: 0.5em 1em;
			user-select: none;
			transition-property: all;
			transition-duration: 0.5s;
		}

		.task:hover {
			background-color: #00ff007f;
		}

		.task-name {
			background-color: #efefefaf;
			border-radius: 1em;
			color: #1f1f1f;
		}

		.task input[type=text] {
			background-color: #0000006f;
		}

		.task input[type=checkbox] {
			width: 1.5em;
			height: 1.5em;
		}

		.add-task-container {
			height: 8em;
			margin-top: 2em;
		}

		.keikoku {
			position: fixed;
			left: 0;
			bottom: 0;
			text-decoration: underline;
			font-weight: bolder;
		}

		.calender-sticky-parent {
			width: 40%;
			height: 100%;
		}

		.calender-container {
			position: sticky;
			top: 5em;
			overflow-x: auto;
			overflow-y: hidden;
		}

		.calender-controller-button-container {
			display: flex;
			justify-content: space-around;
			align-items: center;
			height: 2.5em;
		}

		table {
			border-collapse: collapse;
			border-spacing: 0;
			user-select: none;
			width: 80%;
			margin: 0 auto;
		}

		td {
			font-size: 2em;
			padding: 0.25em;
			border: solid;
		}

		th {
			border: solid;
			padding: 0.5em 0;
			text-align: center;
		}

		td, th {
			border-color: white;
		}

		th:first-child, td:first-child {
			color: red;
		}

		th:last-child, td:last-child {
			color: aqua;
		}

		td.is-disabled {
			color: #6f6f6f;
		}


		/* .popup-container {
		
		}

		.popup-back {
			position: fixed;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			z-index: 10;
			background-color: #0000007f;
		} */

		/* hover時に動いたり色が変わったりするスゲーやつ */
		.animation-button-container {
			display: flex;
			justify-content: space-around;
			user-select: none;
			overflow: hidden;
		}

		.animation-button-container > button {
			height: 100%;
			width: 40%;
			padding: 0 1em;
			background-color: #0000007f;
			transition-property: all;
			transition-duration: 0.5s;
		}

		.animation-button-container > button:hover {
			background-color: #00ff007f;
			width: 50%;
		}

	</style>
</head>
<body>
	<!-- <img th:src="@{/img/meshitero.jpg}" class="back-image"> -->
	<img src="../static/img/forest.jpg" alt="森" class="back-image">
	<div class="content-wrapper">

		<header>
			<h1>FetCH₂() TodoList</h1>
		</header>

		<main>

			<div class="hidden">
				<!-- 実際にth:eachを使ってtaskが入るところ -->
				<ul id="actualUndoneList">
					<form method="post" class="task" action="@{/update}">
						<input type="checkbox" name="done_flg" value="0" />
						<input type="hidden" name="id" value="1" />
						<input type="text" name="title" value="aiueo" />
						<input type="datetime-local" name="time_limit" value="2024-07-10T10:00" />
						<input type="submit" value="更新"/>
					</form>
					<form method="post" class="task" action="@{/update}">
						<input type="checkbox" name="done_flg" value="0" />
						<input type="hidden" name="id" value="1" />
						<input type="text" name="title" value="sasisuseso" />
						<input type="datetime-local" name="time_limit" value="2022-07-10T10:00" />
						<input type="submit" value="更新"/>
					</form>
					<form method="post" class="task" action="@{/update}">
						<input type="checkbox" name="done_flg" value="0" />
						<input type="hidden" name="id" value="1" />
						<input type="text" name="title" value="vimのプラグインのなんかよくわかんないバグ直す" />
						<input type="datetime-local" name="time_limit" value="2022-07-11T10:00" />
						<input type="submit" value="更新"/>
					</form>
					<form method="post" class="task" action="@{/update}">
						<input type="checkbox" name="done_flg" value="0" />
						<input type="hidden" name="id" value="1" />
						<input type="text" name="title" value="VIMをマスターする" />
						<input type="datetime-local" name="time_limit" value="2024-06-14T10:00" />
						<input type="submit" value="更新"/>
					</form>
				</ul>
				<!-- 実際にth:eachを使ってtaskが入るところ -->
				<ul id="actualDoneList">
					<li method="post" class="task" th:action="@{/update}" th:each="todo : ${doneTodos}">
						<input type="checkbox" name="done_flg" value="1" />
						<input type="hidden" name="id" value="2" />
						<input type="text" name="title" value="kakikukeko" style="text-decoration: line-through;"/>
						<input type="datetime-local" name="time_limit" value="2024-08-10" />
						<input type="submit" value="更新"/>
					</li>
					<li method="post" class="task" th:action="@{/update}" th:each="todo : ${doneTodos}">
						<input type="checkbox" name="done_flg" value="1" />
						<input type="hidden" name="id" value="2" />
						<input type="text" name="title" value="朝食を食べる" style="text-decoration: line-through;"/>
						<input type="datetime-local" name="time_limit" value="2024-08-10" />
						<input type="submit" value="更新"/>
					</li>
				</ul>
			</div>

			<div class="todo-container">

				<div class="container-controller animation-button-container">
					<button>未完了のタスクを表示</button>
					<button>完了済みのタスクを表示</button>
				</div>

				<div class="container-wrapper">
					<section class="list-container">
						<h3><span class="js-calender-date"></span>の未完了のマイタスク</h3>
						<div class="task-list" id="undoneListDisplayer">
							<div class="task">
								<p class="task-name">Sample Task0000</p>
								<p class="task-time-limit">Time Limit: 01/01 11:09</p>
							</div>
							<div class="task">
								<p class="task-name">Sample Task0001</p>
								<p class="task-time-limit">Time Limit: 06/01 14:15</p>
							</div>
						</div>
						<button class="list-container-bottom-button">タスクを追加</button>
					</section>
				</div>

				<div class="container-wrapper">
					<section class="list-container">
						<h3><span class="js-calender-date"></span>の完了済みタスク</h3>
						<div class="task-list" id="doneList">
							<p class="task-not-found-message">Task Not Found 404</p>
						</div>
						<form method="post" th:action="@{/delete}">
							<input type="submit" class="list-container-bottom-button" value="完了済みを削除" />
						</form>
					</section>
				</div>

				<!-- <section class="add-task-container">
					<h3>新しいタスクを追加</h3>
					<form method="post" th:action="@{/add}">
						<input type="text" name="title" />
						<input type="datetime-local" name="time_limit" />
						<input type="submit" name="追加" />
					</form>
				</section> -->
			</div>

			<div class="calender-sticky-parent">
				<section class="calender-container">
					<div class="calender-controller-button-container animation-button-container">
						<button id="setCalenderLastMonth">先月</button>
						<button id="setCalenderNextMonth">翌月</button>
					</div>
					<div id="dynamicCalender"></div>
				</section>
			</div>

		</main>

		<div class="popup-container">
			<div class="popup-back"></div>
			<div class="settings-container">
				<div class="settings-item"></div>
				<div class="settings-item"></div>
			</div>
			<div class="todo-update-ui-container">
				<form action="" method="post"></form>
			</div>
		</div>
	</div>

	<p class="keikoku">これはサンプルファイルです。本番用ではありません</p>

	<script>

		//childrenとかgetElementsByClassNameとかで返ってくるHTML要素の配列の子要素ごとに実行する関数
		HTMLCollection.prototype.forEach = function(fn) {
			for (let i = 0, l = this.length; i < l; i++) {
				fn(this[i]);
			}
		};

		// datetime-localのvalueの値（なんか頭痛が痛いみたいな）から年、月、日、時間、分をそれぞれ個別に取得できる正規表現
		const DATETIME_LOCAL_REGEX = /((\d{4})-((?:0[1-9])|(?:1[0-2]))-((?:0[1-9])|(?:[12]\d)|(?:3[01])))(?:T((?:[01]\d)|(?:2[0-3])):((?:[0-5]\d)))?/;

		// 引数dateの月のカレンダーのHTMLの生成する関数
		function createCalenderHtml(date) {
			const WEEK_STR_ARR = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
			//一週間は何日あるかの定数
			const WEEK_COUNT = 7;
			//一か月に何週間あるかの定数
			const MONTH_WEEKS_COUNT = 6;

			const currentYear = date.getFullYear();
			const currentMonth = date.getMonth() + 1;

			//月の最初の日付
			const monthStartDate = new Date(currentYear, currentMonth - 1, 1);
			//月の最後の日付
			//(currentMonth + 1)月の0日目 => currentMonthの最終日
			const monthEndDay = new Date(currentYear, currentMonth, 0);

			//前月の最後の日付
			//(currentMonth)月の0日目 => 前月の最終日
			const lastMonthEndDate = new Date(currentYear, currentMonth - 1, 0);

			const endDayCount = monthEndDay.getDate();
			const monthStartDay = monthStartDate.getDay();

			let dayCount = 1;
			let calenderHtml = "";

			calenderHtml += `<h1>${currentYear}/${currentMonth}</h1>`;
			calenderHtml += "<table>";

			//Sun. ~ Sat. のやつ
			calenderHtml += "<tr>";
			for (let i = 0; i < WEEK_COUNT; i++) {
				calenderHtml += `<th>${WEEK_STR_ARR[i]}.</th>`;
			}
			calenderHtml += "</tr>";


			for (let i = 0; i < MONTH_WEEKS_COUNT; i++) {
				calenderHtml += "<tr>";

				for (let j = 0; j < WEEK_COUNT; j++) {
					if (i === 0 && j < monthStartDay) {
						//月の最初の週かつ、月の始まりの曜日の前なら
						let num = lastMonthEndDate.getDate() - monthStartDay + j + 1;
						calenderHtml += `<td class="is-disabled">${num}</td>`;
					} else if (dayCount > endDayCount) {
						//月の
						let num = dayCount - endDayCount;
						calenderHtml += `<td class="is-disabled">${num}</td>`;
						dayCount++;
					} else {
						calenderHtml += `<td data-date="${currentYear}_${currentMonth}_${dayCount}">${dayCount}</td>`;
						dayCount++;
					}
				}

				calenderHtml += "</tr>";
			}
			return calenderHtml;
		}

		// 引数dateでdynamicCalenderのinnerHTMLにカレンダーのHTMLを生成して代入する関数
		function setCalenderHtml(date) {
			const calenderHtml = createCalenderHtml(date);

			document.getElementById("dynamicCalender").innerHTML = calenderHtml;
		}

		// calenderがボタンが押されたなどして更新したときに実行される関数
		function onUpdateCalender() {
			const undoneList = document.getElementById("undoneList");
			const calenderDateTexts = document.getElementsByClassName("js-calender-date");

			const calenderDate = calenderController.getCurrentDate();

			// undoneList.children.forEach((e) => {
			// 	const datetimeLocalValue = e.querySelector("input[type=datetime-local]").value;

			// 	if (datetimeLocalValue) {
			// 		const datetimeInfo = DATETIME_LOCAL_REGEX.exec(datetimeLocalValue);
			// 		if (datetimeInfo) {
			// 			const [_, date, year, month, day] = datetimeInfo.map(e => Number.parseInt(e));

			// 			const currentYear = calenderDate.getFullYear();
			// 			const currentMonth = calenderDate.getMonth() + 1;
			// 			if (currentYear !== year || currentMonth !== month) {
			// 				e.style.display = "none";
			// 			} else {
			// 				e.style.display = "block";
			// 			}
			// 		}
			// 	}
			// });

			calenderDateTexts.forEach((e) => {
				e.innerText = `${calenderDate.getFullYear()}/${calenderDate.getMonth() + 1}`;
			});
		}

		// undoneList, doneListのtaskのdatetime-localの値を読み取り、calenderにそれぞれ色をつける関数
		function markCalender() {
			//document.getElementsByClassName("undoneList")[1].querySelector("input[name=time_limit]").value
		}


		class CalenderController {
			constructor() {
				//変数nowとメンバ変数nowとメンバ変数currentDateを同時に初期化
				const now = this.now = this.currentDate = new Date();
				this.monthOffset = 0;
				setCalenderHtml(now);
			}

			getCurrentDate() {
				return this.currentDate;
			}

			setCalenderLastMonth() {
				this.monthOffset--;
				const year = this.now.getFullYear();
				const month = this.now.getMonth();
				const currentDate = this.currentDate = new Date(year, month + this.monthOffset);
				setCalenderHtml(currentDate);
			}

			setCalenderNextMonth() {
				this.monthOffset++;
				const year = this.now.getFullYear();
				const month = this.now.getMonth();
				const currentDate = this.currentDate = new Date(year, month + this.monthOffset);
				setCalenderHtml(currentDate);
			}
		}
		const calenderController = new CalenderController();

		document.getElementById("setCalenderLastMonth").addEventListener("click", (e) => {
			calenderController.setCalenderLastMonth();
			onUpdateCalender();
		});
		document.getElementById("setCalenderNextMonth").addEventListener("click", (e) => {
			calenderController.setCalenderNextMonth();
			onUpdateCalender();
		});

		onUpdateCalender();
	</script>
</body>
</html>
